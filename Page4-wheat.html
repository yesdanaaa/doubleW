<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Last Irrigation - Smart Irrigation</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #eff6ff, #f0fdfa, #ecfdf5);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      overflow: hidden;
      background: white;
      box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2); /* Тень в цвет воды */
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      z-index: 10;
      border: 2px solid white;
    }

    .circle img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .container {
      width: 100%;
      max-width: 500px;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: 40px 24px;
      border-radius: 24px;
      border: 1px solid rgba(191, 219, 254, 0.6); /* Чуть голубоватая рамка */
      box-shadow: 0 20px 40px rgba(0,0,0,0.06);
      text-align: center;
    }

    .slogan-badge {
      font-size: 11px;
      font-weight: 600;
      color: #15803d;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 12px;
      display: block;
    }

    h1 {
      font-size: 24px;
      color: #065f46;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #64748b;
      margin-bottom: 25px;
      font-size: 14px;
    }

    /* Календарь */
    .calendar-card {
      background: white;
      border-radius: 16px;
      border: 1px solid #e2e8f0;
      padding: 15px;
      margin-bottom: 25px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .calendar-header h2 {
      font-size: 17px;
      color: #1e293b;
    }

    .arrow {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #eff6ff;
      color: #3b82f6;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      font-weight: bold;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .weekday {
      font-size: 11px;
      font-weight: 600;
      color: #94a3b8;
      padding-bottom: 8px;
    }

    .day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 50%;
      font-size: 14px;
      transition: 0.2s;
      color: #334155;
    }

    .day:hover:not(.empty) { background: #f1f5f9; }

    .day.selected {
      background: #3b82f6 !important;
      color: white !important;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(59, 130, 246, 0.4);
    }

    .day.empty { cursor: default; }

    .complete-btn {
      width: 100%;
      padding: 16px;
      background: #059669;
      color: white;
      border: none;
      border-radius: 14px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
      opacity: 0.4;
      pointer-events: none;
    }

    .complete-btn.active {
      opacity: 1;
      pointer-events: auto;
    }

    .complete-btn:hover { background: #047857; transform: translateY(-1px); }
  </style>
</head>
<body>

  <div class="circle">
    <img id="gif" src="label1.png" alt="Logo">
  </div>

  <div class="container">
    <span class="slogan-badge">Save water. Save world.</span>
    <h1 id="mainTitle">Last time you watered</h1>
    <p class="subtitle">Select the date of your most recent irrigation</p>

    <div class="calendar-card">
      <div class="calendar-header">
        <div class="arrow" onclick="changeMonth(-1)">&#10094;</div>
        <h2 id="monthYear"></h2>
        <div class="arrow" onclick="changeMonth(1)">&#10095;</div>
      </div>

      <div class="calendar-grid" id="calendarGrid">
        <div class="weekday">Sun</div><div class="weekday">Mon</div><div class="weekday">Tue</div>
        <div class="weekday">Wed</div><div class="weekday">Thu</div><div class="weekday">Fri</div><div class="weekday">Sat</div>
      </div>
    </div>

    <button id="completeBtn" class="complete-btn" onclick="finishOnboarding()">Complete Registration</button>
  </div>

  <script>
    const grid = document.getElementById("calendarGrid");
    const monthYearLabel = document.getElementById("monthYear");
    const completeBtn = document.getElementById("completeBtn");
    const mainTitle = document.getElementById("mainTitle");

    const selectedCrop = localStorage.getItem('selectedCrop') || 'crop';
    mainTitle.innerText = `Last time you watered the ${selectedCrop.toLowerCase()}`;

    let viewDate = new Date();
    let selectedDateStr = null; 

    const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];

    function renderCalendar() {
      const existingDays = grid.querySelectorAll('.day, .empty');
      existingDays.forEach(d => d.remove());

      const year = viewDate.getFullYear();
      const month = viewDate.getMonth();
      monthYearLabel.textContent = `${months[month]} ${year}`;

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      for (let i = 0; i < firstDay; i++) {
        const div = document.createElement("div");
        div.className = "day empty";
        grid.appendChild(div);
      }

      for (let d = 1; d <= daysInMonth; d++) {
        const div = document.createElement("div");
        div.className = "day";
        div.textContent = d;

        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
        

        if (selectedDateStr === dateStr) {
          div.classList.add("selected");
        }

        div.onclick = function() {
          selectedDateStr = dateStr;
          completeBtn.classList.add("active");
          renderCalendar();
        };

        grid.appendChild(div);
      }
    }

    function changeMonth(offset) {
      viewDate.setMonth(viewDate.getMonth() + offset);
      renderCalendar();
    }

    function finishOnboarding() {
      if (selectedDateStr) {
        localStorage.setItem('lastIrrigationDate', selectedDateStr);
        localStorage.setItem('irrigationHistory', JSON.stringify([selectedDateStr]));
        localStorage.setItem('isOnboarded', 'true');
        window.location.href = "frontend.html"; 
      }
    }

    renderCalendar();
  </script>

</body>
</html>